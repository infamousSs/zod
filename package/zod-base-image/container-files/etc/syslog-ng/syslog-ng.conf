@version:3.27
@include "scl.conf"
@include "env.conf"

# syslog-ng configuration file.
#
# See syslog-ng(8) and syslog-ng.conf(5) for more information.
#
# Note: It also sources additional configuration files (*.conf)
#	   located in /etc/syslog-ng/conf.d/.

#
# Options
#
options {
	# Create destination directories if missing.
	create_dirs(yes);

	# The default action of syslog-ng is to log a MARK line to the file every
	# 20 minutes. That's seems high for most people so turn it down to once an
	# hour. Set it to zero if you don't want the functionality at all.
	mark_freq(3600);

	# The default action of syslog-ng is to log a STATS line to the file every
	# 10 minutes. That's pretty ugly after a while. Change it to every 12 hours
	# so you get a nice daily update of how many messages syslog-ng missed (0).
	stats_freq(43200);

	# Time to wait before a died connection is re-established (default is 60).
	time_reopen(5);

	# Disable DNS usage.
	# syslog-ng blocks on DNS queries, so enabling DNS may lead to a DoS attack.
	use_dns(no);
	dns-cache(no);

	# Default owner, group, and permissions for log files.
	owner(root);
	group(adm);
	perm(0640);

	# Default permissions for created directories.
	dir_perm(0755);
};


#
# Templates
#

template t_file {
	template("${ISODATE} | ${LEVEL} | ${MSGHDR}${MSG}\n");
};


#
# Sources
#

source s_sys {
	# Standard system log source.
	system();

	# Messages generated by syslog-ng.
	internal();
};

# TCP server
source s_server {
    tcp(ip(127.0.0.1) port(`TCP_PORT`));
};


#
# Destinations
#
destination d_mesg { file("/var/log/messages" template(t_file)); };

# Send messages to console of everyone logged in.
destination d_cons_all { usertty("*"); };

# Send message to the root's console.
destination d_cons_root { usertty("root"); };

# Server log
destination d_server {
  file("/var/log/server.log");
};

destination d_fluent_bit {
	network(`FLUENT_HOST` port(`FLUENT_PORT`));
};

#
# Filters
#


#
# Logs
#

log { source(s_sys);destination(d_mesg); };

log {
    source(s_server);
    destination(d_server);
    destination(d_fluent_bit);
};

# Source additional configuration files (.conf extension only)
# @include "/etc/syslog-ng/conf.d/*.conf"